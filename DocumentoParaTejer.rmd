---
header-includes:
- \usepackage{longtable}
- \usepackage[utf8]{inputenc}
- \usepackage[provide=*]{babel}
- \setlength{\parindent}{1.25cm}
- \usepackage{amsmath}
- \usepackage{array}
- \usepackage{float}
- \usepackage{multirow}
- \renewcommand{\contentsname}{Tabla de Contenidos}
- \renewcommand{\listfigurename}{Lista de Figuras}
- \renewcommand{\listtablename}{Lista de Tablas}
- \usepackage{caption}
- \captionsetup[table]{name=Tabla}
- \captionsetup[figure]{name=Figura}
- \usepackage{graphicx}
output:
  pdf_document: 
    number_sections: true
    fig_width: 4
    fig_height: 3.5
  word_document: default
fontsize: 12pt
papersize: letter
geometry: margin = 1in
language: es
editor_options:
  markdown:
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, fig.align = "center", fig.pos = "H")
library(kableExtra)
library(knitr)
library(leaps)
library(data.table)
library(tidyverse)
library(stats)
library(formattable)
```

```{=tex}
\input{titlepage}
\thispagestyle{empty}
\tableofcontents
\newpage
\thispagestyle{empty}
\listoffigures
\listoftables
\newpage
```

```{=tex}
\pagestyle{myheadings}
\setcounter{page}{3}
```

\section{Variables, Limpieza de Datos y Cruce de Módulos}

Lo primero será seleccionar las variables, filtrar por área y en general, alistar los datos para ingresarlos al modelo.

\subsection{Variables}

Las variables seleccionadas se encuentran en dos módulos, \emph{Características generales, seguridad social en salud y educación} y \emph{Ocupados}. La descripción completa de los módulos y en detalle de cada variable se encuentra en los metadatos (diccionario). Las variables son:

Del módulo de \emph{Características generales, seguridad social en salud y educación}:

\begin{itemize}
 \item \emph{DIRECTORIO}, \emph{SECUENCIA\_P} y \emph{ORDEN}: son los identificadores de la vivienda, hogar y persona, respectivamente. Estas variables se concatenan en una sola para obtener un identificador y este se utiliza a modo de llave para unir los diferentes módulos. La unión de estas variables se nombrará como \textbf{id\_persona} en los datos limpios
 \item \emph{AREA}: es la variable que permite filtrar los datos por área. En este caso, como se trabaja con el Área Metropolitana del Valle de Aburrá, se filtrará por el valor $05$ de la variable. Conservará el nombre \textbf{area} en los datos limpios
 \item \emph{P3271}: ¿cuál es el sexo al nacer? Para capturar si hay brechas salariales asociadas al sexo. Es una variable cualitativa que toma el valor de $1$ si responde \emph{Masculino} y $2$ si responde \emph{Femenino}. Se renombrará por \textbf{sexo} en los datos limpios y el grupo base será $1 =$ \emph{Masculino}
 \item \emph{P6050}: ¿cuál es el parentesco con el jefe del hogar? Para capturar cómo los roles en el hogar pueden influenciar el salario. Es una variable cualitativa que toma el valor de $1$ para \emph{Jefe (a) del hogar}; $2$ para \emph{Pareja, esposo(a), cónyuge, compañero(a)}; $3$ para \emph{Hijo(a), hijastro(a)}; $4$ para \emph{Padre o madre}; $5$ para \emph{Suegro(a)}; $6$ para \emph{Hermano(a) o hermanastro(a)}; $7$ para \emph{Yerno o nuera}; $8$ para \emph{Nieto(a)}; $9$ para \emph{Otro pariente}; $10$ para \emph{Empleado(a) del servicio doméstico y sus parientes}; $11$ para \emph{Pensionista}; $12$ para \emph{Trabajador}; y $13$ para \emph{Otro no pariente}. Se renombrará por \textbf{jefe\_hogar} en los datos limpios y el grupo base será $9 =$ \emph{Otro no pariente}
  \item \emph{P6070}: estado civil. Es una variable cualitativa que toma el valor de $1$ para \emph{No está casado(a) y vive en pareja hace menos de dos años}; $2$ para \emph{No está casado (a) y vive en pareja hace dos años o más}; $3$ para \emph{Está casado (a)}; $4$ para \emph{Está separado (a) o divorciado (a)}; $5$ para \emph{Está viudo (a)}; y $6$ para \emph{Está soltero (a)}. Se renombrará por \textbf{estado\_civil} en los datos limpios y el grupo base será $6 =$ \emph{Está soltero (a)} 
 \item \emph{P6080}: ¿se reconoce dentro de alguna etnia? Para capturar brechas salariales entre diferentes etnias. Es una variable cualitativa que toma el valor de $1$ para \emph{Indígena}; $2$ para \emph{Gitano (a) (Rom)}; $3$ para \emph{Raizal del archipiélago de San Andrés, Providencia y Santa Catalina}; $4$ para \emph{Palenquero (a) de San Basilio}; $5$ para \emph{Negro (a), mulato (a) (afrodescendiente), afrocolombiano(a)}; y $6$ para \emph{Ninguno de los anteriores}. Se renombrará por \textbf{etnia} en los datos limpios y el grupo base será $6 =$ \emph{Ninguno de los anteriores} 
 \item \emph{P3042}: ¿cuál es el mayor nivel educativo alcanzado y el último grado o semestre aprobado? Para capturar si se cumple la teoría del capital humano. Es una variable cualitativa que toma el valor de $1$ para \emph{Ninguno}; $2$ para \emph{Preescolar}; $3$ para \emph{Básica primaria (1o - 5o)}; $4$ para \emph{Básica secundaria (6o - 9o)}; $5$ para \emph{Media académica (Bachillerato clásico)}; $6$ para \emph{Media técnica (Bachillerato técnico)}; $7$ para \emph{Normalista}; $8$ para \emph{Técnica profesional}; $9$ para \emph{Tecnológica}; $10$ para \emph{Universitaria}; $11$ para \emph{Especialización}; $12$ para \emph{Maestría}; $13$ para \emph{Doctorado}; y $99$ para \emph{No sabe, no informa}. Se renombrará por \textbf{educacion} en los datos limpios y el grupo base será $1 =$ \emph{Ninguno}
 \item \emph{Experiencia potencial}: pretende ser una aproximación a la experiencia laboral en base a la edad y el nivel educativo, dado que no se pregunta directamente cuántos años de experiencia tiene la persona. Es una variable numérica que se calcula así: si la persona tiene un nivel educativo de \emph{Básica secundaria} o menor será la \texttt{edad - $15$}; si la persona tiene un nivel educativo entre \emph{Bachillerato clásico} y \emph{Normalista} será la \texttt{edad - $17$}; si la persona tiene un nivel educativo entre \emph{Técnica Profesional} y \emph{Tecnológica} será la \texttt{edad - $20$}; y, si la persona tiene un nivel educativo de \emph{Universitaria} o superior será la \texttt{edad - $22$}. La inclusión de esta variable hace que se excluya la variable \emph{edad} directamente, pues la inclusión de ambas ocacionaría problemas de multicolinealidad. Además, se incluirá también la experiencia potencial al cuadrado $(experiencia\_potencial^2)$ para capturar la relación no lineal y si la relación marginal es creciente o decreciente. Se nombrará \textbf{exp\_potencial} en los datos limpios
\end{itemize}

Del módulo de \emph{Ocupados}:

\begin{itemize}
 \item \emph{DIRECTORIO}, \emph{SECUENCIA\_P} y \emph{ORDEN}: son los identificadores de la vivienda, hogar y persona, respectivamente. Estas variables se concatenan en una sola para obtener un identificador y este se utiliza a modo de llave para unir los diferentes módulos. La unión de estas variables se nombrará como \textbf{id\_persona} en los datos limpios
 \item \emph{AREA}: es la variable que permite filtrar los datos por área. En este caso, como se trabaja con el Área Metropolitana del Valle de Aburrá, se filtrará por el valor $05$ de la variable. Conservará el nombre \textbf{area} en los datos limpios
 \item \emph{INGLABO}: será la variable respuesta, ya que hace referencia a los ingresos laborales mensuales de la persona. Es una variable numérica. Se renombrará por \textbf{salario} en los datos limpios
 \item \emph{P6440}: ¿para realizar este trabajo tiene usted algún tipo de contrato? Pretende ser una aproximación para capturar información de formalidad e informalidad. Es una variable cualitativa que toma el valor de $1$ si responde que \emph{Sí} y $2$ si responde que \emph{No}. Se renombrará por \textbf{contrato} en los datos limpios y el grupo base será $2 =$ \emph{No} 
 \item \emph{P6920}: ¿está cotizando actualmente a un fondo de pensiones? También intenta aproximar a las personas que son formales e informales. Pues, es poco común que los informales coticen a pensión. No se utiliza afiliación a salud, pues, existe una gran cobertura de salud bajo régimen subsidiado en Colombia, lo que no permite segmentar correctamente formales de informales. Es una variable cualitativa que toma el valor de $1$ si responde que \emph{Sí}; $2$ si responde que \emph{No}; y $3$ si responde que \emph{Ya es pensionado}. Se renombrará por \textbf{cotiza\_pension} en los datos limpios y el grupo base será $3 =$ \emph{Ya es pensionado} 
 \end{itemize}
 
\subsection{Limpieza de Datos}
 
Una vez elegidas las variables, lo siguiente es alistar los datos para realizar el cruce. Lo primero es leer solo las variables seleccionadas (se tiene la precaución de leer toda la base como caráter, para evitar que se eliminen 0 a la izquierda en columnas de tipo texto). Después, filtrar los datos por área, pues las áreas diferentes al Área Metropolitana del Valle de Aburrá y las demás variables no son de interés para este estudio.

```{r}
# Se leen los datos y se seleccionan únicamente las variables de interés en los dos módulos

modulo_caracteristicas <- fread("sep2022/Caracteristicas generales, seguridad social en salud y educacion.CSV",
                                colClasses = "character", # para evitar la eliminación de 0 a la izquierda, como en el caso de area
                                select = c("DIRECTORIO", "SECUENCIA_P",
                                           "ORDEN", "AREA", "P3271",
                                           "P6040", "P6050",
                                           "P6070", "P6080", "P3042")) 

modulo_ocupados <- fread("sep2022/Ocupados.CSV",
                         colClasses = "character",
                         select = c("DIRECTORIO", "SECUENCIA_P",
                                    "ORDEN", "AREA", "INGLABO",
                                    "P6440", "P6920", "P6960"))

```

```{r}
# Se filtran los valores que pertenecen al Área Metropolitana del Valle de Aburrá
modulo_caracteristicas <- modulo_caracteristicas[AREA == "05"]
modulo_ocupados <- modulo_ocupados[AREA == "05"]
```

Posteriormente, se crea la variable \textbf{id\_persona} al concatenar las variables descritas anteriormente. Luego, se eliminan las variables que se utilizaron para crear la llave, ya que no serán de utilidad por separado y se renombran las variables que incluirá el modelo como se indicó anteriormente.

```{r}
# Se crea la variable id_persona con la suma de las variables "DIRECTORIO", "SECUENCIA_P", "ORDEN" y "HOGAR" (se pueden simplemente sumar, pues se leyeron los datos como character)
modulo_caracteristicas$id_persona <- paste(modulo_caracteristicas$DIRECTORIO,
                                           modulo_caracteristicas$SECUENCIA_P,
                                           modulo_caracteristicas$ORDEN,
                                           sep = "")

modulo_ocupados$id_persona <- paste(modulo_ocupados$DIRECTORIO,
                                    modulo_ocupados$SECUENCIA_P,
                                    modulo_ocupados$ORDEN,
                                    sep = "")

# Se eliminan las variables "DIRECTORIO", "SECUENCIA_P", "ORDEN" y "HOGAR"
modulo_caracteristicas <- modulo_caracteristicas[, c("id_persona", "AREA",
                                                     "P3271", "P6040",
                                                     "P6050", "P6070",
                                                     "P6080", "P3042")]

modulo_ocupados <- modulo_ocupados[, c("id_persona", "AREA",
                                       "INGLABO", "P6440",
                                       "P6920")]
```

También, se cambia la clase de cada variable a la que le corresponde y se establecen los grupos base en las variables de tipo cualitativas.

```{r}
# Se renombran las variables, se le dan las clases correctas a cada variable y se establecen los grupos base

modulo_caracteristicas <- rename(modulo_caracteristicas, area = AREA,
                                 sexo = P3271, edad = P6040,
                                 jefe_hogar = P6050, estado_civil = P6070,
                                 etnia = P6080, educacion = P3042)

modulo_caracteristicas$sexo <- as.factor(modulo_caracteristicas$sexo) # Se cambia a factor
modulo_caracteristicas$sexo <- relevel(modulo_caracteristicas$sexo, ref = "1") # Se establece el grupo base como Masculino
modulo_caracteristicas$edad <- as.numeric(modulo_caracteristicas$edad) # Se cambia a numérico
modulo_caracteristicas$jefe_hogar <- as.factor(modulo_caracteristicas$jefe_hogar) # Se cambia a factor
modulo_caracteristicas$jefe_hogar <- relevel(modulo_caracteristicas$jefe_hogar, ref = "9") # Se establece el grupo base como Otro no pariente
modulo_caracteristicas$estado_civil <- as.factor(modulo_caracteristicas$estado_civil) # Se cambia a factor
modulo_caracteristicas$estado_civil <- relevel(modulo_caracteristicas$estado_civil, ref = "6") # Se establece el grupo base como Está soltero (a)
modulo_caracteristicas$etnia <- as.factor(modulo_caracteristicas$etnia) # Se cambia a factor
modulo_caracteristicas$etnia <- relevel(modulo_caracteristicas$etnia, ref = "6") # Se establece el grupo base como Ninguno de los anteriores
modulo_caracteristicas$educacion <- as.factor(modulo_caracteristicas$educacion) # Se cambia a factor
modulo_caracteristicas$educacion <- relevel(modulo_caracteristicas$educacion, ref = "1") # Se establece el grupo base como Ninguno


modulo_ocupados <- rename(modulo_ocupados, area = AREA,
                          salario = INGLABO, contrato = P6440,
                          cotiza_pension = P6920)

modulo_ocupados$salario <- as.numeric(modulo_ocupados$salario) # Se cambia a numérico
modulo_ocupados$contrato <- as.factor(modulo_ocupados$contrato) # Se cambia a factor
modulo_ocupados$contrato <- relevel(modulo_ocupados$contrato, ref = "2") # Se establece el grupo base como No
modulo_ocupados$cotiza_pension <- as.factor(modulo_ocupados$cotiza_pension) # Se cambia a factor
modulo_ocupados$cotiza_pension <- relevel(modulo_ocupados$cotiza_pension, ref = "3") # Se establece el grupo base como Ya es pensionado
```

Finalmente, una vez las demás variables están listas, se construye la variable \emph{exp\_potencial} al restar la edad promedio de los graduados en cada nivel educativo a la edad

```{r}
for (i in 1:nrow(modulo_caracteristicas)) {
  if (modulo_caracteristicas$educacion[i] %in% c(1, 2, 3, 4, 99)) {
    modulo_caracteristicas$exp_potencial[i] <- modulo_caracteristicas$edad[i] - 15
  } else if (modulo_caracteristicas$educacion[i] %in% c(5, 6, 7)) {
    modulo_caracteristicas$exp_potencial[i] <- modulo_caracteristicas$edad[i] - 17
  } else if (modulo_caracteristicas$educacion[i] %in% c(8, 9)) {
    modulo_caracteristicas$exp_potencial[i] <- modulo_caracteristicas$edad[i] - 20
  } else {
    modulo_caracteristicas$exp_potencial[i] <- modulo_caracteristicas$edad[i] - 22
  }
} # Se evalúa cada elemento de educación con un ciclo for y se le asigna la resta según sea el caso

modulo_caracteristicas$exp_potencial <- as.numeric(modulo_caracteristicas$exp_potencial) # Se establece como numérico

modulo_caracteristicas <- modulo_caracteristicas[, -c("edad")] # Se elimina edad
```

```{r}
kable(
  head(modulo_caracteristicas),
  caption = "Datos Módulo de Características Generales",
  escape = F,
  booktab = T,
  align = "c",
  row.names = T
)

kable(
  head(modulo_ocupados),
  caption = "Datos Módulo de Ocupados",
  escape = F,
  booktab = T,
  align = "c",
  row.names = T
)
```

En las tablas 1 y 2 se puede observar el alistamiento de cada módulo por separado.

\subsection{Cruce de módulos}

Con los datos ya limpios, se procede a realizar un inner join con la función \texttt{merge} del paquete \texttt{base}. De esta manera se unirán las variables de los dos módulos solo en los casos en que el \textbf{id\_persona} se encuentre en ambos módulos.

```{r, include = FALSE}
# Antes, se verifica que las llaves sean únicas para evitar cualquier tipo de problema en la unión
length(modulo_caracteristicas$id_persona) == length(unique(modulo_caracteristicas$id_persona))

length(modulo_ocupados$id_persona) == length(unique(modulo_ocupados$id_persona))

# Comprobado que son únicos, se procede a unir
datos_cruce <- merge(x = modulo_caracteristicas,
              y = modulo_ocupados,
              by = 'id_persona')
# Se elimina area.y y se renombra area.x
datos_cruce <- datos_cruce[,!"area.y"]
datos_cruce <- rename(datos_cruce, area = area.x)

# Otra verificación de que la unión es correcta, es que el número de datos de ocupados y datos limpios es igual
length(nrow(modulo_caracteristicas)) == length(nrow(datos_cruce))

# Se guardan los datos limpios en un nuevo dataset
fwrite(datos_cruce, file = "sep2022/datosCruce.CSV")
```

```{r}
kable(
  head(datos_cruce[, c("id_persona", "area", "jefe_hogar",
                       "estado_civil", "etnia")]),
  caption = "Datos Cruce 1 de 2",
  escape = F,
  booktab = T,
  align = "c",
  row.names = T
)

kable(
  head(datos_cruce[, c("educacion", "salario", "contrato",
                         "cotiza_pension", "exp_potencial")]),
  caption = "Datos Cruce 2 de 2",
  escape = F,
  booktab = T,
  align = "c",
  row.names = T
)
```

Realizada la unión, en las tablas 3 y 4 se puede visualizar la estructura final de los datos de las variables de interés.

\section{Análisis Descriptivo de las Variables}

\subsection{Variables Numéricas}
\subsubsection{Salario (INGLABO)}

```{r}
# Kable no renderiza la salida de summary. Procedo a calcular estadísticas descriptivas manualmente
salario_summary <- c(
  min(datos_cruce$salario, na.rm = TRUE),
  quantile(datos_cruce$salario, probs = 0.25, na.rm = TRUE),
  median(datos_cruce$salario, na.rm = TRUE),
  mean(datos_cruce$salario, na.rm = TRUE),
  quantile(datos_cruce$salario, probs = 0.75, na.rm = TRUE),
  max(datos_cruce$salario, na.rm = TRUE),
  sum(is.na(datos_cruce$salario)),
  sum(datos_cruce$salario == 0, na.rm = TRUE)
)

salario_summary <- format(salario_summary, big.mark = ".",
                          decimal.mark = ",", scientific = FALSE)

# Se crea una tabla con los resultados
salario_tabla <- matrix(salario_summary, nrow = 1)
colnames(salario_tabla) <- c("Mínimo", "Cuartil 1", "Mediana", "Promedio", "Cuartil 3", "Máximo", "NA's", "Ceros")

# Mostrar la tabla con kable
kable(
  salario_tabla,
  caption = "Resumen de la Variable Salario",
  escape = F,
  booktab = T,
  align = "c")
```

En la tabla $5$ se observa que la variable salario tiene un claro sesgo positivo, que se nota por la diferencia entre media y mediana. Este se produce por la aparicion de datos de ingreso muy elevados y se deberán tratar de manera adecuada para evitar que se conviertan en datos influyentes en la regresión.

```{r, fig.cap = "Histograma de Salario", warning = FALSE}
# Histograma
ggplot(datos_cruce, aes(x = salario)) +
  geom_histogram(aes(y = ..density..), fill = "skyblue", color = "black", bins = 30) +
  geom_density(color = "red") +
  labs(title = NULL,
       x = "Salario",
       y = "Frecuencia") +
  scale_x_continuous(labels = scales::comma_format(big.mark = ".")) +
  theme_minimal()
```

```{r, fig.cap = "Diagrama de Caja y Bigotes de Salario", warning = FALSE}
# Diagrama de caja y bigotes
ggplot(datos_cruce, aes(x = "", y = salario)) +
  geom_boxplot(fill = "skyblue", color = "black") +
  labs(title = NULL,
       x = NULL,  # Elimina la etiqueta del eje x
       y = "Salario") +
  scale_y_continuous(labels = scales::comma_format(big.mark = ".")) +
  theme_minimal()
```

En las figuras $1$ y $2$ se confirma el patrón de sesgo de cola derecha, en donde hay presencia de datos extremos en la distribución. La variable salario se debe incluir después de tomar logaritmo natural, lo cual es común en este tipo de estimación.

Lo primero es eliminar los NA's y valores en 0, dado que no aportarán información al modelo.

```{r}
datos_cruce <- subset(datos_cruce, !is.na(salario) & salario != 0)
```

Después, mediante el método de Tukey se identifican los valores extremos al calcular un límite inferior y superior mediante la multiplicación de el rango intercuartílico con el cuartil 1 y 3:

```{r, fig.cap = "Diagrama de Caja y Bigotes de Salario con Valores Extremos"}
q1 <- quantile(datos_cruce$salario, 0.05)
q3 <- quantile(datos_cruce$salario, 0.95)

iqr <- q3 - q1 # rango intercuatílico

limite_inferior <- q1 - iqr
limite_superior <- q3 + iqr

valores_extremos <- datos_cruce$salario[datos_cruce$salario < limite_inferior | datos_cruce$salario > limite_superior]


ggplot(datos_cruce, aes(x = "", y = salario)) +
  geom_boxplot(fill = "skyblue", color = "black") +
  geom_point(data = datos_cruce[datos_cruce$salario %in% valores_extremos, ], aes(x = "", y = salario), color = "red", size = 3) +
  labs(title = NULL,
       x = NULL,
       y = "Salario") +
  scale_y_continuous(labels = scales::comma_format(big.mark = ".",
                                                   decimal.mark = ",")) +
  theme_minimal()
```

Luego de identificar los valores extremos potencialmente influyentes, se aplica el método de winsorización, donde los valores extremos se reemplazan por los límites correspondientes.

```{r}
datos_cruce$salario[datos_cruce$salario < limite_inferior] <- limite_inferior
datos_cruce$salario[datos_cruce$salario > limite_superior] <- limite_superior
```

Finalmente, corregidos los valores extremos se procede a aplicar logaritmo natural y se deja la variable lista para ingresar al modelo. En la figura $4$ se observa que el sesgo se eliminó y que es probable que la estimación mejore por la no presencia de datos extremos:
```{r, fig.cap = "Histograma del Logaritmo de Salario"}
datos_cruce$salario <- log(datos_cruce$salario)

ggplot(datos_cruce, aes(x = salario)) +
  geom_histogram(aes(y = ..density..), fill = "skyblue", color = "black", bins = 30) +
  geom_density(color = "red") +
  labs(title = NULL,
       x = "Logaritmo de Salario",
       y = "Frecuencia") +
  scale_x_continuous(labels = scales::comma_format(big.mark = ".",
                                                   decimal.mark = ",")) +
  theme_minimal()
```

\subsubsection{Experiencia Potencial}

```{r}
exp_summary <- c(
  min(datos_cruce$exp_potencial, na.rm = TRUE),
  quantile(datos_cruce$exp_potencial, probs = 0.25, na.rm = TRUE),
  median(datos_cruce$exp_potencial, na.rm = TRUE),
  mean(datos_cruce$exp_potencial, na.rm = TRUE),
  quantile(datos_cruce$exp_potencial, probs = 0.75, na.rm = TRUE),
  max(datos_cruce$exp_potencial, na.rm = TRUE),
  sum(is.na(datos_cruce$exp_potencial))
)

exp_tabla <- matrix(exp_summary, nrow = 1)
colnames(exp_tabla) <- c("Mínimo", "Cuartil 1", "Mediana",
                         "Promedio", "Cuartil 3", "Máximo", "NA's")

kable(
  exp_tabla,
  caption = "Resumen de la Variable Experiencia Potencial",
  escape = F,
  booktab = T,
  align = "c")
```

En la tabla $6$ se observa que la variable tiene un ligero sesgo positivo, que se evidencia por la diferencia entre media y mediana. También, hay presencia de datos negativos. Esto se produce porque la edad promedio de graduación de los diferentes niveles educativos es mayor que la edad de la persona. Por simplicidad, se asumirá que la experiencia de la persona es igual a $0$.

```{r}
datos_cruce$exp_potencial[datos_cruce$exp_potencial < 0] <- 0
```

```{r, fig.cap = "Histograma de Experiencia Potencial", warning = FALSE}
# Histograma
ggplot(datos_cruce, aes(x = exp_potencial)) +
  geom_histogram(aes(y = ..density..), fill = "skyblue", color = "black", bins = 30) +
  geom_density(color = "red") +
  labs(title = NULL,
       x = "Experiencia Potencial",
       y = "Frecuencia") +
  theme_minimal()
```

```{r, fig.cap = "Diagrama de Caja y Bigotes de Experiencia Potencial", warning = FALSE}
# Diagrama de caja y bigotes
ggplot(datos_cruce, aes(x = "", y = exp_potencial)) +
  geom_boxplot(fill = "skyblue", color = "black") +
  labs(title = NULL,
       x = NULL,  # Elimina la etiqueta del eje x
       y = "Experiencia Potencial") +
  theme_minimal()
```

En las figuras $5$ y $6$ se confirma la presencia de sesgo. Sin embargo se incluirá sin transformar al modelo, pues este sesgo es mínimo.

\subsection{Variables Cualitativas}

\subsubsection{Sexo al Nacer}

```{r}
# Se crea la tabla de frecuencias absolutas y relativas
frec_abs <- table(datos_cruce$sexo)
frec_rel <- prop.table(frec_abs)

# Se combinan las frecuencias absolutas y relativas en un dataframe
tabla_frecuencias <- data.frame(Sexo = names(frec_abs),
                                `Frecuencia Absoluta` = as.numeric(frec_abs),
                                `Frecuencia Relativa` = as.numeric(frec_rel))

colnames(tabla_frecuencias) <- c("Sexo", "Frecuencia Absoluta", "Frecuencia Relativa")

kable(tabla_frecuencias,
      caption = "Tabla de Frecuencias de la variable Sexo al Nacer",
      escape = F,
      booktab = T,
      align = "c",
)
```

En la tabla $7$ se observa que la participación de cada sexo en la encuesta es similar. Sin embargo, hay más hombres que mujeres en la muestra.

\subsubsection{Parentesco con el Jefe(a) del Hogar}

```{r}
# Se crea la tabla de frecuencias absolutas y relativas
frec_abs <- table(datos_cruce$jefe_hogar)
frec_rel <- prop.table(frec_abs)

# Se combinan las frecuencias absolutas y relativas en un dataframe
tabla_frecuencias <- data.frame(`Jefe(a) Hogar` = as.numeric(names(frec_abs)),
                                `Frecuencia Absoluta` = as.numeric(frec_abs),
                                `Frecuencia Relativa` = as.numeric(frec_rel))

colnames(tabla_frecuencias) <- c("Parentesco Jefe(a) Hogar", "Frecuencia Absoluta",
                                 "Frecuencia Relativa")
tabla_frecuencias <- arrange(tabla_frecuencias, `Parentesco Jefe(a) Hogar`) # Se ordenan

kable(tabla_frecuencias,
      caption = "Tabla de Frecuencias de la variable Parentesco Jefe(a) Hogar",
      escape = F,
      booktab = T,
      align = "c",
      row.names = F
)
```

En la tabla $8$ se observa que la participación de las personas que son jefe(a) del hogar, pareja o hijo de este es considerablemente mayores que las demás categorías. Mientras que padre o madre, suegro(a) y pensionista aparecen muy pocas veces.

\subsubsection{Estado Civil}

```{r}
# Se crea la tabla de frecuencias absolutas y relativas
frec_abs <- table(datos_cruce$estado_civil)
frec_rel <- prop.table(frec_abs)

# Se combinan las frecuencias absolutas y relativas en un dataframe
tabla_frecuencias <- data.frame(`Estado Civil` = as.numeric(names(frec_abs)),
                                `Frecuencia Absoluta` = as.numeric(frec_abs),
                                `Frecuencia Relativa` = as.numeric(frec_rel))

colnames(tabla_frecuencias) <- c("Estado Civil", "Frecuencia Absoluta",
                                 "Frecuencia Relativa")
tabla_frecuencias <- arrange(tabla_frecuencias, `Estado Civil`) # Se ordenan

kable(tabla_frecuencias,
      caption = "Tabla de Frecuencias de la variable Estado Civil",
      escape = F,
      booktab = T,
      align = "c",
      row.names = F
)
```

En la tabla $9$ se observa que la participación de las personas que son solteras, están casadas o viven en unión libre es considerablemente mayores que las demás categorías. Se elimina la categoría NA.

```{r}
datos_cruce$estado_civil <- as.character(datos_cruce$estado_civil)
datos_cruce <- datos_cruce[datos_cruce$estado_civil != "NA", ]
datos_cruce$estado_civil <- as.factor(datos_cruce$estado_civil)
datos_cruce$estado_civil <- relevel(datos_cruce$estado_civil, ref = "6")
```

